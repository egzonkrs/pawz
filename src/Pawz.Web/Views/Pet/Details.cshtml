@model Pawz.Web.Models.Pet.AdoptionRequestCreateModel

@{
    ViewBag.Title = "title";
}

<div class="text-center">
    <button class="btn btn-primary mb-4 adoption-request-button" data-toggle="modal" data-target="#adoptionRequestModal">
        Adoption Request
    </button>
</div>

<partial name="AdoptionRequestCreateModel" model="@Model" />
@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const allCities = @Html.Raw(@Json.Serialize(Model.AllCities));
            console.log("All Cities:", allCities);

            function populateDropdown(parentId, allItems, childId, defaultText, parentKey) {
                const childSelect = document.querySelector(`#${childId}`);

                childSelect.innerHTML = '';

                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = `Select ${defaultText}`;
                defaultOption.selected = true;
                defaultOption.disabled = true;
                defaultOption.hidden = true;
                defaultOption.classList.add('default-option');

                childSelect.appendChild(defaultOption);

                if (parentId) {
                    const filteredItems = allItems.filter(item => item[parentKey] === parseInt(parentId));
                    console.log(`Filtered ${defaultText}:`, filteredItems);

                    filteredItems.forEach(item => {
                        const option = document.createElement('option');
                        option.value = item.id;
                        option.textContent = item.name;
                        childSelect.appendChild(option);
                    });

                    console.log(`${defaultText} dropdown HTML:`, childSelect.innerHTML);
                }

                $(childSelect).niceSelect('update');
            }

            $('#CityId').niceSelect();
            $('#CountryId').niceSelect();

            $('#CountryId').on('change', function () {
                const countryId = $(this).val();
                console.log("Selected Country ID:", countryId);
                populateDropdown(countryId, allCities, 'CityId', 'City', 'countryId');
            });

            const initialCountryId = $('#CountryId').val();
            if (initialCountryId) {
                populateDropdown(initialCountryId, allCities, 'CityId', 'City', 'countryId');
            }
        });
    </script>
}


